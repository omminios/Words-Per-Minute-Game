"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ejs = require("ejs");
const fs = require("fs-extra");
const ef8 = {
    encoding: 'utf-8',
};
function preprocess(envContainer, predicate = s => s) {
    const result = Object.keys(envContainer.env).reduce((p, c) => {
        Object.assign(p.env, {
            [c]: predicate(envContainer.env[c]),
        });
        return p;
    }, {
        env: {},
    });
    return result;
}
class EnvironmentTemplateHandler {
    renderEnvContextTemplateFile(path, envContainer, callback) {
        if (callback) {
            fs.readFile(path, ef8, (err, templatBuffer) => {
                if (err) {
                    callback(err);
                }
                else {
                    const template = templatBuffer.toString();
                    callback(null, EnvironmentTemplateHandler.renderEnvContext(template, envContainer));
                }
            });
        }
        else {
            return fs
                .readFile(path, ef8)
                .then(template => {
                return EnvironmentTemplateHandler.renderEnvContext(template, envContainer);
            })
                .catch(e => {
                throw e;
            });
        }
    }
    renderEnvContextTemplateFileSync(path, envContainer) {
        const template = fs.readFileSync(path, ef8);
        return EnvironmentTemplateHandler.renderEnvContext(template, envContainer);
    }
    static renderEnvContext(template, envContainer) {
        const compiled = ejs.compile(template);
        const result = compiled(preprocess(envContainer));
        return result;
    }
}
exports.EnvironmentTemplateHandler = EnvironmentTemplateHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW52aXJvbm1lbnQtdGVtcGxhdGUtaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9lbnZpcm9ubWVudC10ZW1wbGF0ZS1oYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkJBQTJCO0FBQzNCLCtCQUErQjtBQU0vQixNQUFNLEdBQUcsR0FBRztJQUNWLFFBQVEsRUFBRSxPQUFPO0NBQ2xCLENBQUM7QUFFRixvQkFDRSxZQUF5QixFQUN6QixZQUFtQyxDQUFDLElBQUksQ0FBQztJQUV6QyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQ2pELENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDSCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUU7WUFDbkIsQ0FBQyxDQUFDLENBQUMsRUFBRSxTQUFTLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUUsQ0FBQztTQUNyQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQyxFQUNEO1FBQ0UsR0FBRyxFQUFFLEVBQUU7S0FDUixDQUNGLENBQUM7SUFFRixNQUFNLENBQUMsTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRDtJQVVTLDRCQUE0QixDQUNqQyxJQUFZLEVBQ1osWUFBeUIsRUFDekIsUUFBcUQ7UUFFckQsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNiLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRSxhQUFhO2dCQUN4QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNSLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEIsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixNQUFNLFFBQVEsR0FBRyxhQUFhLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQzFDLFFBQVEsQ0FDTixJQUFJLEVBQ0osMEJBQTBCLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUNwRSxDQUFDO2dCQUNKLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLE1BQU0sQ0FBQyxFQUFFO2lCQUNOLFFBQVEsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDO2lCQUNuQixJQUFJLENBQUMsUUFBUTtnQkFDWixNQUFNLENBQUMsMEJBQTBCLENBQUMsZ0JBQWdCLENBQ2hELFFBQVEsRUFDUixZQUFZLENBQ2IsQ0FBQztZQUNKLENBQUMsQ0FBQztpQkFDRCxLQUFLLENBQUMsQ0FBQztnQkFDTixNQUFNLENBQUMsQ0FBQztZQUNWLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQztJQUNILENBQUM7SUFFTSxnQ0FBZ0MsQ0FDckMsSUFBWSxFQUNaLFlBQXlCO1FBRXpCLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDN0UsQ0FBQztJQUVNLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FDNUIsUUFBZ0IsRUFDaEIsWUFBeUI7UUFFekIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN2QyxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFDbEQsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNoQixDQUFDO0NBQ0Y7QUExREQsZ0VBMERDIn0=